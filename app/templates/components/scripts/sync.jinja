<script>
        var interval = 2000;  // 1000 = 1 second
        function syncState() {
                $.ajax({
                        type: 'GET',
                        url: '{{ url_for("sync_state")}}',
                        success: function (data) {
                                if (data.connection.state === 'active') {
                                        $('#connection-avatar').html(`<span class="avatar avatar-xl"
                                        style="background-image: url({{ avatars.gravatar('${data.connection.alias}') }})"></span>`);
                                        $('#connection-label').html(data.connection.their_label);
                                        $('#btn-issuance').css("pointer-events", "auto");
                                        $('#btn-revocation').css("pointer-events", "auto");
                                        $('#btn-presentation').css("pointer-events", "auto");
                                } else {}
                                if (data.cred_ex.state === null) {
                                        $('#issuance-state').html(`<span class="badge"></span> No Exchange`);
                                } else if (data.cred_ex.state === 'abandonned') {
                                        $('#issuance-state').html(`<span class="badge bg-danger"></span> Abandonned`);
                                } else if (data.cred_ex.state === 'credential-revoked') {
                                        $('#issuance-state').html(`<span class="badge bg-warning"></span> Revoked`);
                                } else if (data.cred_ex.state === 'done') {
                                        $('#issuance-state').html(`<span class="badge bg-green"></span> Completed`);
                                        $('#btn-revocation').removeClass("disabled");
                                } else {
                                        $('#issuance-state').html(`<span class="badge bg-warning"></span> Pending`);
                                }
                                if (data.pres_ex.state === null) {
                                        $('#presentation-state').html(`<span class="badge"></span> No Exchange`);
                                } else if (data.cred_ex.state === 'abandonned') {
                                        $('#presentation-state').html(`<span class="badge bg-danger"></span> Abandonned`);
                                } else if (data.pres_ex.state === 'done') {
                                        if (data.pres_ex.verified === 'true') {
                                                $('#presentation-state').html(`<span class="badge bg-green"></span> Verified`);
                                        } else if (data.pres_ex.verified === 'false') {
                                                $('#presentation-state').html(`<span class="badge bg-danger"></span> Unverified`);
                                        } else {
                                                $('#presentation-state').html(`<span class="badge bg-danger"></span> Problem`);
                                        }
                                } else {
                                        $('#presentation-state').html(`<span class="badge bg-warning"></span> Pending`);
                                }
                                // $('#registry-state').html(``);
                                console.log(data);
                        },
                        complete: function (data) {
                                // Schedule the next
                                setTimeout(syncState, interval);
                        }
                });
        }
        setTimeout(syncState, interval);
</script>